{"componentChunkName":"component---src-templates-blog-post-js","path":"/rx-toggle-buttons/","webpackCompilationHash":"9b20e9a61845373a28e0","result":{"data":{"site":{"siteMetadata":{"title":"My Notes","author":"Yasser Zadeh"}},"markdownRemark":{"id":"85eceb73-5804-5fa5-a1ae-86ea0167a5f8","excerpt":"A friend at work was trying to find a use-case for RxJS in the admin panel.\nHe came up with filtering buttons on a chart that act as toggle buttons. So\nthatâ€¦","html":"<p>A friend at work was trying to find a use-case for RxJS in the admin panel.\nHe came up with filtering buttons on a chart that act as toggle buttons. So\nthat clicking once the buttons 2 and 1,\ncalls the endpoint <a href=\"#\">/api/data?filter[]=2&#x26;filter[]=1</a>.\nand clicking again the button 1, would result in calling <a href=\"\">/api/data?filter[]=2</a>.</p>\n<p>Looks in Rx, we think in streams. Clicks on the button 1 and 2 are streams.\nSo this problems can be seen as:</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a0630f00cf12deeaf278f818e5b62a51/0794e/toggle-buttons.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 36.30470016207455%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsSAAALEgHS3X78AAAAtUlEQVQoz6WQSQ6EMBAD+f97+A9HDiAIO4TFM9VSR0yug2QSyi3HoTiOQ1VV6b7vv/U8j4pxHFWWpa7rMpAPwfPvnDm3QF7neYqmIQSt66ppmsRBMLRtm3msMcbE38JLgYB93zUMg63zPJs4yA/DewfACUc+kwIJadtWdV1rWRZrRyM4onXTNOYR7OHuIzyunhoyRJAHoHcjGuPxO9jnV8ezhvo+AG+QD7mcdV2nvu9/fPbe8AMOIiJSTM4JYQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"Toggle Buttons\"\n        title=\"\"\n        src=\"/static/a0630f00cf12deeaf278f818e5b62a51/b9e4f/toggle-buttons.png\"\n        srcset=\"/static/a0630f00cf12deeaf278f818e5b62a51/cf440/toggle-buttons.png 148w,\n/static/a0630f00cf12deeaf278f818e5b62a51/d2d38/toggle-buttons.png 295w,\n/static/a0630f00cf12deeaf278f818e5b62a51/b9e4f/toggle-buttons.png 590w,\n/static/a0630f00cf12deeaf278f818e5b62a51/0794e/toggle-buttons.png 617w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>Toggling one button is simple: <code class=\"language-text\">nextState = !state</code>. To keep track of multiple\nbuttons, turn the state to an object: one key per button. Toggling then become:\n<code class=\"language-text\">nextState = {...state, [buttonId]: !state[buttonId]}</code>. To apply this on streams, I tried\nto merge click streams, and apply above technique:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">buttons1\n  <span class=\"token punctuation\">.</span><span class=\"token function\">pipe</span><span class=\"token punctuation\">(</span><span class=\"token function\">merge</span><span class=\"token punctuation\">(</span>buttons2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">pipe</span><span class=\"token punctuation\">(</span><span class=\"token function\">scan</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">acc<span class=\"token punctuation\">,</span> buttonId</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token operator\">...</span>acc<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>buttonId<span class=\"token punctuation\">]</span><span class=\"token punctuation\">:</span> <span class=\"token operator\">!</span>acc<span class=\"token punctuation\">[</span>buttonId<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">pipe</span><span class=\"token punctuation\">(</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">x</span> <span class=\"token operator\">=></span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">k</span> <span class=\"token operator\">=></span> x<span class=\"token punctuation\">[</span>k<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>And to simulate the clicks, I created random streams like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">random</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token number\">0.3</span>\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">g</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">source<span class=\"token punctuation\">,</span> id</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n  source\n   <span class=\"token punctuation\">.</span><span class=\"token function\">pipe</span><span class=\"token punctuation\">(</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>random<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n   <span class=\"token punctuation\">.</span><span class=\"token function\">pipe</span><span class=\"token punctuation\">(</span><span class=\"token function\">distinctUntilChanged</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n   <span class=\"token punctuation\">.</span><span class=\"token function\">pipe</span><span class=\"token punctuation\">(</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span>identity<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">mapTo</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> source <span class=\"token operator\">=</span> <span class=\"token function\">interval</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> buttons <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token function\">g</span><span class=\"token punctuation\">(</span>source<span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">g</span><span class=\"token punctuation\">(</span>source<span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span></code></pre></div>\n<p>You can play with the visualization <del><a href=\"https://rxviz.com/v/j8AnVy3o\">here</a></del> <a href=\"https://rxviz.com/\">rxviz.com</a>, and the code can be found on <a href=\"https://gitlab.com/yassermzh/blog/blob/master/content/blog/rx-toggle-buttons/code.js\">gitlab</a>.</p>\n<p>While creating the visualization, I realized the button streams I created above are\ncold observables. There are three streams: buttons 1, 2, and the result streams. However, as button 1 (or 2) stream is cold, it is different in the result stream. Here is one way I found to make them hot:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">multicast</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">source</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> subject <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Subject</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  source<span class=\"token punctuation\">.</span><span class=\"token function\">subscribe</span><span class=\"token punctuation\">(</span>subject<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> subject<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> hot <span class=\"token operator\">=</span> <span class=\"token function\">multicast</span><span class=\"token punctuation\">(</span>cold<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">of</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">pipe</span><span class=\"token punctuation\">(</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> hot<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>","frontmatter":{"title":"Toggle buttons as filter using RxJS","date":"January 25, 2019"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/rx-toggle-buttons/","previous":{"fields":{"slug":"/deploy-monorepo/"},"frontmatter":{"title":"Deploy Lerna monorepo using Jenkins"}},"next":null}}}