{"componentChunkName":"component---src-templates-blog-post-js","path":"/deploy-monorepo/","webpackCompilationHash":"9b20e9a61845373a28e0","result":{"data":{"site":{"siteMetadata":{"title":"My Notes","author":"Yasser Zadeh"}},"markdownRemark":{"id":"bfd77769-7245-5dad-8a93-9388650ba301","excerpt":"The monorepo is managed by Lerna.As you push to Gitlab, it triggers a Jenkins job.This job checkouts the repository, and loads the  package Jenkinsfile atâ€¦","html":"<ul>\n<li>The monorepo is managed by <a href=\"https://github.com/lerna/lerna\">Lerna</a>.</li>\n<li>As you push to Gitlab, it triggers a Jenkins job.</li>\n<li>This job checkouts the repository, and loads the <code class=\"language-text\">tasks</code> package Jenkinsfile at: <code class=\"language-text\">packages/tasks/Jenkinsfile</code>. There we list all deployable packages. Mostly the packages are not deployable and used as dependencies.</li>\n<li>Each deployable package has one Jenkinsfile at <code class=\"language-text\">packages/PACKAGE/scripts/Jenkinsfile</code> that knows how to deploy itself.</li>\n<li>The <code class=\"language-text\">tasks</code> package Jenkinsfile compares this commit with last successful deploy and find all changed packages and only load Jenkisnfile of those packages.</li>\n</ul>\n<p>The structure of the monorepo is as follows:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">  |\n  |-- packages/\n  |           /tasks/Jenkinsfile\n  |           /notify/\n  |                  /scripts/Jenkinsfile\n  |           /email/</code></pre></div>\n<p>in which the <code class=\"language-text\">notify</code> package is a deployable one, and <code class=\"language-text\">email</code> package is a dependency for <code class=\"language-text\">notify</code>.</p>\n<h2>Development flow</h2>\n<h3>To run locally</h3>\n<ul>\n<li>\n<p>install dependencies</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">lerna bootstrap --hoist</code></pre></div>\n</li>\n<li>\n<p>add dependencies\nHere adding <code class=\"language-text\">@company/email</code> to <code class=\"language-text\">@company/notify</code>. As you notice, we use <code class=\"language-text\">@company</code> to scope npm packages.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">lerna <span class=\"token function\">add</span> @company/email --scope @company/notify</code></pre></div>\n</li>\n<li>\n<p>run only one package</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">cd</span> packages/notify\n<span class=\"token function\">npm</span> start</code></pre></div>\n</li>\n<li>\n<p>run all packages</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">lerna run start</code></pre></div>\n</li>\n</ul>\n<h3>To deploy</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">lerna publish --registry http://registry.company.com</code></pre></div>","frontmatter":{"title":"Deploy Lerna monorepo using Jenkins","date":"November 25, 2018"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/deploy-monorepo/","previous":null,"next":{"fields":{"slug":"/rx-toggle-buttons/"},"frontmatter":{"title":"Toggle buttons as filter using RxJS"}}}}}